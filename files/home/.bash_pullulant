# vim: ft=bash
# shellcheck disable=SC2154,SC1090
# © 2016-2021  Konstantin Gredeskoul
# https://github.com/kigster
#
# For project Pullulant
# https://github.com/kigster/pullulant/
#
# MIT License

set +e

export pfx="${bldpur}[pullulant]${clr}"

function src() {
  local file
  local code

  for file in "$@"; do
    [[ -z $file ]] && break
    if [[ -s "${file}" ]]; then
      ((PULLULANT_DEBUG)) && printf "${pfx} sourcing ${txtgrn}%-50s${clr}..." "${file}"
      source "${file}"
      code=$?
      ((PULLULANT_DEBUG)) && {
        ((code)) && {
           printf "${pfx} ${txtred} [ ${bldred}X${txtred} ], ${italic} exit code=%d${clr}\n" ${code}
           continue
        }
        printf "${txtgrn} [ ✔︎ %s] ${clr}\n" "OK"
      }
    else
      ((PULLULANT_DEBUG)) && printf "${pfx} sourcing ${txtylw}%-50s${clr}... ${txtylw}[ ${bldylw}X${txtylw}, file not found ]${clr}\n" "${file}"
    fi 
  done
  return 0
}

export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export MANPATH="/usr/local/opt/gnu-sed/libexec/gnuman:$MANPATH"
export PGUSER=postgres
export EDITOR=vim
export PAGER='less -R'
export RI='-f ansi'
export HISTCONTROL=ignoredups

declare -a pullulant_plugins=(
  aliases
  aliases_ag
  bash_it
  brew
  colors
  #completion
  docker
  functions
  git
#  git_completion
  grep
  pgsql
  pprocs
  services
  tmux
  user
  bashmatic
)

if [[ -z $(echo "${pullulant_plugins[*]}" | grep "$1") ]] ; then
  for plugin in "$@"; do
    file="${HOME}/.bash_pu_${plugin}"  
    src "${file}"
  done
else
  for plugin in "${pullulant_plugins[@]}"; do
    file="${HOME}/.bash_pu_${plugin}"  
    src "${file}"
  done
fi

# Load rbenv and pyenv without th expensive eval.
for env in rbenv pyenv; do
  dir="${HOME}/.${env}/shims"
  if [[ -d "${dir}" ]] ; then
    export PATH="${dir}:$PATH"
  fi
done





