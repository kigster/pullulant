# vim: ft=bash
# shellcheck disable=SC2154,SC1090
# © 2016-2021  Konstantin Gredeskoul
# https://github.com/kigster
#
# For project Pullulant
# https://github.com/kigster/pullulant/
#
# MIT License

set +e

export pfx="${bldpur}[pullulant]${clr}"

function current_shell() {
  local cmd="$(/bin/ps -p $$ -o comm | tail -1 | sed -E 's/-//g')"
  printf "%s" $(basename ${cmd})
}

function src() {
  local file
  local code

  for file in "$@"; do
    [[ -z $file ]] && break
    if [[ -s "${file}" ]]; then
      ((PULLULANT_DEBUG)) && printf "${pfx} sourcing ${txtgrn}%-50s${clr}..." "${file}"
      source "${file}"
      code=$?
      ((PULLULANT_DEBUG)) && {
        ((code)) && {
           printf "${pfx} ${txtred} [ ${bldred}X${txtred} ], ${italic} exit code=%d${clr}\n" ${code}
           continue
        }
        printf "${txtgrn} [ ✔︎ %s] ${clr}\n" "OK"
      }
    else
      ((PULLULANT_DEBUG)) && printf "${pfx} sourcing ${txtylw}%-50s${clr}... ${txtylw}[ ${bldylw}X${txtylw}, file not found ]${clr}\n" "${file}"
    fi 
  done
  return 0
}

export LANG=en_US.UTF-8
export LC_ALL=en_US.UTF-8
export MANPATH="/usr/local/opt/gnu-sed/libexec/gnuman:$MANPATH"
export PGUSER=postgres
export EDITOR=vim
export PAGER='less -R'
export RI='-f ansi'
export HISTCONTROL=ignoredups


declare -a pullulant_plugins=(
  aliases
  aliases_ag
  brew
  colors
  docker
  functions
  git
  grep
  pgsql
  pprocs
  services
  tmux
  user
)

if [[ $(current_shell) == "bash" ]]; then
  pullulant_plugins+=(git_completion)
  pullulant_plugins+=(completion)

  source ~/.bash_pu_bash_it dark developer
fi

for plugin in "${pullulant_plugins[@]}"; do
  file="${HOME}/.bash_pu_${plugin}"  
  src "${file}"
done

# Load rbenv and pyenv without th expensive eval.
for env in rbenv pyenv; do
  dir="${HOME}/.${env}/shims"
  if [[ -d "${dir}" ]] ; then
    export PATH="${dir}:$PATH"
  fi
done
